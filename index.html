<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>TikTok Login Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body style="font-family: Arial, sans-serif; text-align: center; margin-top: 50px;">
  <h1>Login with TikTok</h1>
  <button id="loginBtn" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
    Login with TikTok
  </button>

  <pre id="debug" style="margin-top:24px; text-align:left; width:90%; max-width:800px; margin-left:auto; margin-right:auto; background:#f8f8f8; padding:12px; border:1px solid #ddd; overflow:auto;"></pre>

  <script>
    // Your TikTok App's Client Key (this is fine to be public)
    const clientKey = "sbawfljgq9n370anqa";

    // *** MUST be EXACTLY this â€” no query params, no ?state ***
    const redirectUri = "https://kyzerch.github.io/GGLABbot/callback.html";

    // Only put state as a separate param (NOT inside redirect_uri)
    const scope = "user.info.basic";
    const state = "test123";

    const authUrl =
      "https://www.tiktok.com/v2/auth/authorize/" +
      "?client_key=" + encodeURIComponent(clientKey) +
      "&scope=" + encodeURIComponent(scope) +
      "&response_type=code" +
      "&redirect_uri=" + encodeURIComponent(redirectUri) +
      "&state=" + encodeURIComponent(state);

    document.getElementById("debug").textContent =
      "Auth URL that will be used:\n\n" + authUrl;

    document.getElementById("loginBtn").onclick = function () {
      window.location.href = authUrl;
    };
  </script>
</body>
</html>
<h2>Upload to TikTok</h2>
<form action="/upload" method="post" enctype="multipart/form-data">
  <input type="file" name="video" accept="video/mp4,video/quicktime" required />
  <button type="submit">Upload</button>
</form>

<h2>Publish</h2>
<form onsubmit="event.preventDefault(); publish()">
  <input id="uploadId" placeholder="Paste upload_id from /upload response" required />
  <input id="caption"   placeholder="Caption (optional)" />
  <button type="submit">Publish</button>
</form>

<script>
async function publish() {
  const body = {
    upload_id: document.getElementById('uploadId').value,
    caption:   document.getElementById('caption').value
  };
  const r = await fetch('/publish', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(body)
  });
  const j = await r.json();
  alert(JSON.stringify(j, null, 2));
}
</script>
